name: Ruff Lint and Auto-fix

on:
  push:
    branches:
      - "**"       # Lance le workflow sur tous les push
  pull_request:
    branches:
      - "**"       # Lance aussi sur toutes les PR

jobs:
  ruff:
    name: Ruff Lint & Auto-fix
    runs-on: ubuntu-latest

    steps:
      # R√©cup√©rer le code
      - name: Checkout code
        uses: actions/checkout@v4

      # Configurer Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # Installer Ruff
      - name: Install Ruff
        run: |
          pip install ruff

      # üõ†Ô∏è √âtape 1 : Corriger ce qui est possible
      - name: Run Ruff with auto-fix
        run: |
          ruff check . --fix

      # üìã √âtape 2 : V√©rifier s‚Äôil reste des erreurs
      - name: Run Ruff in check-only mode
        run: |
          ruff check . --exit-zero | tee ruff_output.txt
          # On va analyser les erreurs restantes
          grep -q "error" ruff_output.txt && exit 1 || echo "‚úÖ No remaining lint errors"

      # üìù √âtape 3 : Commit et push les corrections automatiques (si fichiers modifi√©s)
      - name: Auto-commit Ruff fixes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "style: auto-fix lint issues with Ruff"
          branch: ${{ github.ref }}
        continue-on-error: true  # Ne bloque pas la suite si rien √† commit
